id: org.lyx.LyX.Plugin.SweaveKnitr
runtime: org.lyx.LyX
runtime-version: stable
sdk: org.kde.Sdk//5.15-23.08
build-extension: true
appstream-compose: false
sdk-extensions:
  - org.freedesktop.Sdk.Extension.texlive
build-options:
  prefix: "/app/plugins/SweaveKnitr"
  prepend-path: "/app/plugins/SweaveKnitr/bin:/usr/lib/sdk/texlive/bin:/usr/lib/sdk/dotnet7/bin"
  append-ld-library-path: "/app/plugins/SweaveKnitr/lib:/usr/lib/sdk/texlive/lib:/usr/lib/sdk/dotnet7/lib"
  append-pkg-config-path: "/app/plugins/SweaveKnitr/lib/pkgconfig:/usr/lib/sdk/dotnet7/lib/pkgconfig"
modules:
  - name: tbb #macaulay2
    buildsystem: cmake-ninja
    builddir: true
    build-opts:
      - -DTBB_TEST=OFF
    sources:
      - type: archive
        url: https://github.com/oneapi-src/oneTBB/archive/refs/tags/v2022.0.0.tar.gz
        sha256: e8e89c9c345415b17b30a2db3095ba9d47647611662073f7fbf54ad48b7f3c2a
  - name: boost #macaulay2
    buildsystem: simple
    build-commands:
      - ls /usr/lib/sdk/texlive
      - ./bootstrap.sh --prefix=/app/plugins/SweaveKnitr --with-libraries=locale,filesystem,system,date_time,regex,program_options
      - ./b2 headers
      - ./b2 -j$FLATPAK_BUILDER_N_JOBS install variant=release cxxstd=17 --layout=system
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/boost/boost/1.85.0/boost_1_85_0.tar.bz2
        sha256: 7009fe1faa1697476bdc7027703a2badb84e849b7b0baad5086b087b971f8617
  - name: lapack #macaulay2
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DBUILD_SHARED_LIBS=ON
      - -DBUILD_TESTING=OFF
      - -DLAPACKE=ON
      - -DCBLAS=ON
    sources:
      - type: archive
        url: https://github.com/Reference-LAPACK/lapack/archive/refs/tags/v3.12.0.tar.gz
        sha256: eac9570f8e0ad6f30ce4b963f4f033f0f643e7c3912fc9ee6cd99120675ad48b
  - name: openblas #macaulay2
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DBUILD_TESTING:BOOL=OFF
      - -DDYNAMIC_ARCH:BOOL=ON
    cleanup:
      - /include/openblas
    sources:
      - type: archive
        url: https://github.com/xianyi/OpenBLAS/releases/download/v0.3.28/OpenBLAS-0.3.28.tar.gz
        sha256: f1003466ad074e9b0c8d421a204121100b0751c96fc6fcf3d1456bd12f8a00a1
  - name: googletest #macaulay2
    buildsystem: cmake-ninja
    config-opts:
      # Use RelWithDebInfo build type for all CMake modules
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    cleanup:
      - /*
    sources:
      - type: archive
        url: https://github.com/google/googletest/releases/download/v1.15.2/googletest-1.15.2.tar.gz
        sha256: 7b42b4d6ed48810c5362c265a17faebe90dc2373c885e5216439d37927f02926
  - name: macaulay2
    buildsystem: cmake-ninja
    builddir: true
    subdir: M2
    sources:
      - type: git
        url: https://github.com/Macaulay2/M2.git
        tag: release-1.24.11
  - name: giac
    buildsystem: autotools
    sources:
      - type: archive
        url: https://www-fourier.ujf-grenoble.fr/~parisse/debian/dists/stable/main/source/giac_1.9.0-996.tar.gz
        sha256: 035fab210ac0d455394466dbc8f0f38728ae52f6abe019b24a87499eb783967d
